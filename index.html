<!DOCTYPE  html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <meta name='viewport' content='width=device-width,maximum-scale=1.0,minimum-scale=1.0'>
  <meta http-equiv='X-UA-Compatible' content='ie=edge'>
  <title>X'mas</title>
  <style>
    body {
      font-size: 28px;
      text-align: center;
    }
    label {
      position: fixed;
      top: 0;
      left: 0;
      font-size: 10px;
    }
    .header {
      color: #108757;
      height: 5rem;
    }
    img {
      width: 12rem;
      height: 12rem;
    }
    .hide {
      display: none;
    }
    .body {
      margin: 4rem auto 3rem;
      height: 10rem;
      width: 10rem;
      border: solid 1px #aaa;
      border-radius: 1rem;
      line-height: 10rem;
      position: relative;
    }
    #export {
      display: none;
      margin: -1rem -1rem;
    }
    .footer {

    }
    button {
      font-size: 25px;
      color: #fff;
      width: 15rem;
      height: 4rem;
      background: #8fd16f;
      border: 0;
      border-radius: 1rem;
    }
  </style>
</head>
<body>


  <div class='header'>
    <h2>Happy X'mas</h2>
  </div>
  <div class='body'>
    <small id='uploadText'>点击上传头像</small>
    <input id='upload' type='file' onchange='viewer()' style='height: 10rem; width: 10rem; position: absolute; top: 0; left: 0; opacity: 0'>
    <img id='export' alt='圣诞快乐' src='' style='' />
  </div>
  <div class='footer'>
    <p id='tip' style='opacity: 0'>长按图片保存或分享</p>
    <button id='change' onClick='changeHat()' style='display: none; margin: auto'>换 一 顶</button>
  </div>

  <label>beta版</label>
  <div class='hide'>
    <img id='img' src='' alt=''>
    <canvas id='cvs'></canvas>
    <img class='hide' id='hat0' src='./hat0.png' />
    <img class='hide' id='hat1' src='./hat1.png' />
    <img class='hide' id='hat2' src='./hat2.png' />
    <img class='hide' id='hat3' src='./hat3.png' />
    <img class='hide' id='hat4' src='./hat4.png' />
    <img class='hide' id='hat5' src='./hat5.png' />
    <img class='hide' id='hat6' src='./hat6.png' />
    <img class='hide' id='hat7' src='./hat7.png' />
    <img class='hide' id='hat8' src='./hat8.png' />
    <img class='hide' id='hat9' src='./hat9.png' />
  </div>
<script>
  var cvs = document.getElementById('cvs')
  var ctx = cvs.getContext('2d')
  var hat = 'hat6'

  function viewer () {
    var img = document.getElementById('img')
    var file = document.getElementById('upload').files[0]
    var reader = new FileReader()

    if (file) {
      reader.readAsDataURL(file)
      reader.onload = function (e) {
        img.src = reader.result
        img.onload = function () {
          img2Cvs(img)
        }
      }
    } else {
      img.src = ''
    }
  }

  function img2Cvs (img) {
    cvs.width = img.width
    cvs.height = img.height
    ctx.drawImage(img, 0 ,0, img.width, img.height)
    changeHat()

    document.getElementById('uploadText').style.display = 'none'
    document.getElementById('tip').style.opacity = 1
    document.getElementById('upload').style.display = 'none'
    document.getElementById('export').style.display = 'block'
    document.getElementById('change').style.display = 'block'
  }

  function changeHat () {
    var hats = document.getElementsByClassName('hide')
    var exportImage = document.getElementById('export')
    hat = 'hat' + (+hat.replace('hat', '') + 1) % hats.length
    var hatImage = document.getElementById(hat)
    ctx.clearRect(0, 0, img.width, img.height)
    ctx.drawImage(img, 0 ,0, img.width, img.height)
    ctx.drawImage(hatImage, img.width / 4, 0, img.width / 2, img.height / 2.5)
    exportImage.src = cvs.toDataURL('image/png')
  }
</script>
</body>
</html>
